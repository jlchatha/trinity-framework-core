<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - Trinity Framework 2.0 Core Documentation</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <style>
        .sidebar {
            width: 250px;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            background-color: #f1f8ff;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .nav-section {
            margin-bottom: 20px;
        }
        .nav-section-title {
            font-weight: bold;
            color: #0366d6;
            margin-bottom: 10px;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 5px;
        }
        .nav-list {
            list-style-type: none;
            padding-left: 10px;
        }
        .nav-list li {
            margin-bottom: 8px;
        }
        .nav-list a {
            display: block;
            padding: 5px;
            border-radius: 3px;
        }
        .nav-list a:hover {
            background-color: #e1e4e8;
            text-decoration: none;
        }
        .nav-list a.active {
            background-color: #0366d6;
            color: white;
            text-decoration: none;
        }
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
        .section-nav {
            background-color: #f6f8fa;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 20px;
        }
        .section-nav a {
            margin-right: 15px;
        }
        .api-card {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 16px;
            margin: 24px 0;
            border-left: 4px solid #0366d6;
        }
        .api-card h3 {
            margin-top: 0;
            color: #0366d6;
        }
        .method {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 3px;
            margin-right: 8px;
            font-family: monospace;
            font-weight: bold;
        }
        .method-get {
            background-color: #e1f5fe;
            color: #0277bd;
        }
        .method-post {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .method-put {
            background-color: #fff8e1;
            color: #ff8f00;
        }
        .method-delete {
            background-color: #ffebee;
            color: #c62828;
        }
        .endpoint {
            font-family: monospace;
            padding: 3px 6px;
            background-color: #f6f8fa;
            border-radius: 3px;
        }
        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .params-table th, .params-table td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #dfe2e5;
        }
        .params-table th {
            background-color: #f6f8fa;
        }
        .response-example {
            background-color: #f6f8fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .required {
            color: #d73a49;
            font-weight: bold;
        }
        .optional {
            color: #6a737d;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="nav-section">
            <div class="nav-section-title">Getting Started</div>
            <ul class="nav-list">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../quick-start.html">Quick Start Guide</a></li>
            </ul>
        </div>
        <div class="nav-section">
            <div class="nav-section-title">Reference</div>
            <ul class="nav-list">
                <li><a href="agent-roles.html">Agent Roles</a></li>
                <li><a href="protocol-files.html">Protocol Files</a></li>
                <li><a href="api-reference.html" class="active">API Reference</a></li>
                <li><a href="glossary.html">Glossary</a></li>
            </ul>
        </div>
        <div class="nav-section">
            <div class="nav-section-title">Principles</div>
            <ul class="nav-list">
                <li><a href="../principles/context-resilience.html">Context Resilience</a></li>
                <li><a href="../principles/multi-agent-collaboration.html">Multi-Agent Collaboration</a></li>
            </ul>
        </div>
        <div class="nav-section">
            <div class="nav-section-title">Guides</div>
            <ul class="nav-list">
                <li><a href="../guides/context-management.html">Context Management</a></li>
                <li><a href="../guides/aar-system.html">AAR System</a></li>
                <li><a href="../guides/workspace-organization.html">Workspace Organization</a></li>
                <li><a href="../guides/token-tracking.html">Token Tracking</a></li>
            </ul>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <div class="metadata">
                <strong>VERSION</strong>: 1.0.0 | 
                <strong>CREATED</strong>: June 13, 2025 | 
                <strong>STATUS</strong>: Release Candidate | 
                <strong>FRAMEWORK</strong>: Trinity Framework 2.0
            </div>

            <div class="section-nav">
                <a href="../index.html">Home</a> &gt;
                <a href="#">Reference</a> &gt;
                <span>API Reference</span>
            </div>

            <h1>API Reference</h1>
            
            <p>The Trinity Framework 2.0 Core provides several APIs for context management, token tracking, and system integration. This reference documents the available endpoints, parameters, and response formats.</p>

            <div class="note">
                <p><strong>Note</strong>: All APIs require Claude API access to function properly. Make sure to set up your environment with the appropriate API keys as described in the quick start guide.</p>
            </div>

            <h2>Context Management API</h2>
            
            <div class="api-card">
                <h3>Check Context Status</h3>
                <p><span class="method method-get">GET</span><span class="endpoint">/api/context/status</span></p>
                <p>Retrieves the current context window utilization status and metrics.</p>
                
                <h4>Query Parameters</h4>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>format</td>
                            <td>string</td>
                            <td class="optional">Optional. Response format: 'json' (default) or 'text'</td>
                        </tr>
                        <tr>
                            <td>includeHistory</td>
                            <td>boolean</td>
                            <td class="optional">Optional. Whether to include operation history. Default: false</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Response</h4>
                <div class="response-example">
{
  "status": "success",
  "data": {
    "utilizationPercentage": 45,
    "tokens": 90000,
    "maxTokens": 200000,
    "thresholdStatus": "normal",
    "remainingCapacity": {
      "largeOperations": 10,
      "mediumOperations": 25,
      "smallOperations": 73
    },
    "lastUpdate": "2025-06-13T14:30:45.000Z",
    "checkpoints": [
      {
        "id": "ckpt_notice_20250613",
        "timestamp": "2025-06-13T14:30:45.000Z",
        "utilizationPercentage": 65,
        "thresholdStatus": "notice"
      }
    ]
  }
}</div>
            </div>
            
            <div class="api-card">
                <h3>Update Context State</h3>
                <p><span class="method method-post">POST</span><span class="endpoint">/api/context/update</span></p>
                <p>Updates the context state based on an operation type or specific content.</p>
                
                <h4>Request Body</h4>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>operationType</td>
                            <td>string</td>
                            <td class="required">Required. The type of operation (e.g., 'ASSISTANT_MEDIUM', 'USER_LARGE')</td>
                        </tr>
                        <tr>
                            <td>content</td>
                            <td>string</td>
                            <td class="optional">Optional. The actual content for more accurate token estimation</td>
                        </tr>
                        <tr>
                            <td>createCheckpoint</td>
                            <td>boolean</td>
                            <td class="optional">Optional. Whether to force checkpoint creation. Default: false</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Response</h4>
                <div class="response-example">
{
  "status": "success",
  "data": {
    "utilizationPercentage": 48,
    "tokens": 96000,
    "maxTokens": 200000,
    "thresholdStatus": "normal",
    "tokensAdded": 6000,
    "remainingCapacity": {
      "largeOperations": 10,
      "mediumOperations": 23,
      "smallOperations": 69
    },
    "checkpointCreated": false
  }
}</div>
            </div>
            
            <div class="api-card">
                <h3>Create Checkpoint</h3>
                <p><span class="method method-post">POST</span><span class="endpoint">/api/context/checkpoint</span></p>
                <p>Creates a manual checkpoint of the current context state.</p>
                
                <h4>Request Body</h4>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>label</td>
                            <td>string</td>
                            <td class="optional">Optional. Custom label for the checkpoint</td>
                        </tr>
                        <tr>
                            <td>metadata</td>
                            <td>object</td>
                            <td class="optional">Optional. Custom metadata to store with the checkpoint</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Response</h4>
                <div class="response-example">
{
  "status": "success",
  "data": {
    "checkpoint": {
      "id": "ckpt_manual_20250613150045",
      "timestamp": "2025-06-13T15:00:45.000Z",
      "utilizationPercentage": 48,
      "thresholdStatus": "normal",
      "label": "Pre-task checkpoint",
      "metadata": {
        "taskId": "task-123",
        "projectName": "Example Project"
      }
    }
  }
}</div>
            </div>

            <h2>Auto-Compact API</h2>
            
            <div class="api-card">
                <h3>Detect Auto-Compact</h3>
                <p><span class="method method-get">GET</span><span class="endpoint">/api/auto-compact/detect</span></p>
                <p>Checks if an auto-compact event has occurred.</p>
                
                <h4>Query Parameters</h4>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>threshold</td>
                            <td>number</td>
                            <td class="optional">Optional. The drop threshold percentage for detection. Default: 40</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Response</h4>
                <div class="response-example">
{
  "status": "success",
  "data": {
    "autoCompactDetected": true,
    "detectionMethod": "utilizationDrop",
    "previousUtilization": 85,
    "currentUtilization": 25,
    "dropPercentage": 60,
    "timeSinceLastUpdate": "30 minutes",
    "recoveryPrepared": true
  }
}</div>
            </div>
            
            <div class="api-card">
                <h3>Prepare Recovery</h3>
                <p><span class="method method-post">POST</span><span class="endpoint">/api/auto-compact/prepare-recovery</span></p>
                <p>Prepares recovery state from a specified checkpoint or the most recent one.</p>
                
                <h4>Request Body</h4>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>checkpointId</td>
                            <td>string</td>
                            <td class="optional">Optional. Specific checkpoint ID to recover from. If not provided, uses the most recent checkpoint.</td>
                        </tr>
                        <tr>
                            <td>initialUtilization</td>
                            <td>number</td>
                            <td class="optional">Optional. Initial utilization percentage for the new context. Default: 25</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Response</h4>
                <div class="response-example">
{
  "status": "success",
  "data": {
    "recoveryState": {
      "recoveryMode": true,
      "recoveryTimestamp": "2025-06-13T15:15:45.000Z",
      "previousState": {
        "utilizationPercentage": 85,
        "tokenCount": 170000,
        "maxTokens": 200000,
        "checkpoints": [
          {
            "id": "ckpt_alert_20250613",
            "timestamp": "2025-06-13T15:00:45.000Z",
            "utilizationPercentage": 85,
            "thresholdStatus": "alert"
          }
        ]
      },
      "newState": {
        "utilizationPercentage": 25,
        "tokenCount": 50000,
        "maxTokens": 200000
      }
    }
  }
}</div>
            </div>

            <h2>Report API</h2>
            
            <div class="api-card">
                <h3>Generate Context Report</h3>
                <p><span class="method method-get">GET</span><span class="endpoint">/api/reports/context</span></p>
                <p>Generates a detailed report on context utilization and operations.</p>
                
                <h4>Query Parameters</h4>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>format</td>
                            <td>string</td>
                            <td class="optional">Optional. Report format: 'json' (default), 'text', or 'html'</td>
                        </tr>
                        <tr>
                            <td>timeframe</td>
                            <td>string</td>
                            <td class="optional">Optional. Timeframe for the report: 'session' (default), 'day', 'week'</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>Response</h4>
                <div class="response-example">
{
  "status": "success",
  "data": {
    "report": {
      "timeframe": "session",
      "startTime": "2025-06-13T10:00:00.000Z",
      "endTime": "2025-06-13T15:30:00.000Z",
      "initialUtilization": 10,
      "peakUtilization": 85,
      "finalUtilization": 25,
      "autoCompactEvents": 1,
      "checkpointsCreated": 3,
      "operationCounts": {
        "USER_SMALL": 15,
        "USER_MEDIUM": 8,
        "USER_LARGE": 2,
        "ASSISTANT_SMALL": 10,
        "ASSISTANT_MEDIUM": 12,
        "ASSISTANT_LARGE": 3,
        "TOOL_READ_SMALL": 20,
        "TOOL_READ_MEDIUM": 5,
        "TOOL_READ_LARGE": 1,
        "TOOL_WRITE": 7,
        "TOOL_EDIT": 4,
        "TOOL_TASK": 2
      }
    }
  }
}</div>
            </div>

            <h2>Claude API Requirements</h2>
            
            <p>All Trinity Framework 2.0 Core APIs require access to the Claude API for operation. You must set up the following environment variables:</p>
            
            <table class="params-table">
                <thead>
                    <tr>
                        <th>Environment Variable</th>
                        <th>Description</th>
                        <th>Required</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>CLAUDE_API_KEY</td>
                        <td>Your Claude API key for authentication</td>
                        <td class="required">Required</td>
                    </tr>
                    <tr>
                        <td>CLAUDE_API_MODEL</td>
                        <td>The Claude model to use (default: claude-3-opus-20240229)</td>
                        <td class="optional">Optional</td>
                    </tr>
                    <tr>
                        <td>CLAUDE_API_URL</td>
                        <td>Custom API URL (if using a proxy or enterprise endpoint)</td>
                        <td class="optional">Optional</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="warning">
                <p><strong>Warning</strong>: Never hardcode API keys in your code. Always use environment variables or secure credential management systems.</p>
            </div>

            <h2>Related Resources</h2>
            
            <ul>
                <li><a href="../guides/token-tracking.html">Token Tracking Guide</a></li>
                <li><a href="../guides/context-management.html">Context Management Guide</a></li>
                <li><a href="../quick-start.html">Quick Start Guide</a></li>
            </ul>
        </div>
        
        <footer>
            <p>Trinity Framework 2.0 Core &copy; 2025 | Licensed under Apache 2.0</p>
            <p><em>Framework 2.0 COMPLIANT</em></p>
        </footer>
    </div>
</body>
</html>